!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("@clubajax/dom"),require("@clubajax/on"),require("@clubajax/base-component"),require("@clubajax/form")):"function"==typeof define&&define.amd?define(["@clubajax/dom","@clubajax/on","@clubajax/base-component","@clubajax/form"],e):"object"==typeof exports?exports["data-table"]=e(require("@clubajax/dom"),require("@clubajax/on"),require("@clubajax/base-component"),require("@clubajax/form")):t["data-table"]=e(t["@clubajax/dom"],t["@clubajax/on"],t["@clubajax/base-component"],t["@clubajax/form"])}(this,(function(t,e,s,i){return function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=3)}([function(e,s){e.exports=t},function(t,e){t.exports={bindMethods:function(t,e){Object.keys(t).forEach(s=>{"function"==typeof t[s]&&(e[s]=t[s])}),t.init&&t.init.call(e)},isEqual:function(t,e){return t===e||!(!t&&e||t&&!e)&&JSON.stringify(t)===JSON.stringify(e)}}},function(t,s){t.exports=e},function(t,e,s){"use strict";s.r(e);s(4),s(12)},function(t,e,s){const i=s(5),r=s(0),o=s(6),n=s(7),l=s(8),a=s(9),h=s(10),c=s(1);function d(){}t.exports=i.define("data-table",class extends i{constructor(){super(),this.clickable=!1,this.sortable=!1,this.selectable=!1,this.scrollable=!1,this.legacyCheck()}onRows(t){this.schema&&(this.isSchemaUpdate=!0,this.loadData(t))}onSchema(t){this.serversort&&this.isSchemaUpdate&&this.setSort(t.sort,t.desc?"desc":"asc")}loadData(t){const e=t||[];this.orgItems=e,this.legacyCheck(!0),e.length?(this.displayNoData(!1),this.items=[...e],this.mixPlugins(),clearTimeout(this.noDataTimer),this.onDomReady(()=>{this.render()})):this.displayNoData(!0)}legacyCheck(t){t?clearTimeout(this.legacyTimer):this.legacyTimer=setTimeout(()=>{throw new Error("a `rows` and a `schema` is required")},1e3)}domReady(){this.perf=this.perf||!0,this.items||(this.noDataTimer=setTimeout(()=>{this.displayNoData(!0)},1e3))}render(){this.fire("pre-render"),this.renderTemplate(),this.renderFooter(this.schema.columns.length);const t=this.schema.columns;c.isEqual(t,this.columns)||(this.columns=t,this.renderHeader(this.columns)),this.renderBody(this.items,this.columns),this.fire("render",{table:this.table||this,thead:this.thead,tbody:this.tbody})}renderTemplate(){this.table||(this.table=r("table",{tabindex:"1"},this),this.thead=r("thead",{},this.table),this.tbody=r("tbody",{},this.table))}renderHeader(t){r.clean(this.thead,!0);const e=r("tr",{},this.thead),s=[];t.forEach((t,i)=>{const o=t.key||t,n=void 0===t.label?t:t.label,l=t.css||t.className||"",a={html:[r("span",{html:n,css:"ui-label"}),r("span",{class:"sort-up",html:"&uarr;"}),r("span",{class:"sort-dn",html:"&darr;"})],css:l,"data-field":o};t.width&&(s[i]=t.width,a.style={width:t.width}),r("th",a,e)}),this.colSizes=s,this.headHasRendered=!0,this.fire("render-header",{thead:this.thead})}renderBody(t,e){this.exclude;const s=this.tbody;if(r.clean(s,!0),!t||!t.length)return this.bodyHasRendered=!0,this.fire("render-body",{tbody:this.tbody}),void this.displayNoData(!0);const i=this.selectable;void 0===t[0].id&&console.warn("Items do not have an ID"),function(t,e,s,i,o,n){t.forEach((t,n)=>{t.index=n;const l=t.css||t.class||t.className;let a,c,d,u,b={"data-row-id":t.id};o&&(b.tabindex=1),l&&(b.class=l),u=r("tr",b,i),e.forEach((e,i)=>{d=e.key||e,e.component?a=h(e,t):(a="index"===d?n+1:t[d],e.callback&&(a=e.callback(t,n))),c=d;const o={html:a,"data-field":d,css:c};s[i]&&(o.style={width:s[i]}),r("td",o,u)})}),n()}(t,e,this.colSizes,s,i,()=>{this.bodyHasRendered=!0,this.fire("render-body",{tbody:this.tbody})})}renderFooter(t){this.footer&&(this.tfoot=r("tfoot",{html:r("tr",{html:r("td",{html:this.footer,colspan:t})})},this.table))}getItemById(t){return this.items.find(e=>""+e.id==""+t)}displayNoData(t){t?this.classList.add("no-data"):this.classList.remove("no-data")}mixPlugins(){this.clickable&&n.call(this),(this.serversort||this.schema.sort)&&(n.call(this),o.call(this)),this.selectable&&(n.call(this),l.call(this)),this.scrollable&&a.call(this),this.mixPlugins=d}},{props:["schema","rows","sort","selected","stretch-column","max-height","borders","footer"],bools:["sortable","serversort","selectable","scrollable","clickable","perf"]})},function(t,e){t.exports=s},function(t,e,s){const i=s(1),r=s(0),o={init(){this.classList.add("sortable"),this.current={},this.on("render-header",this.onHeaderRender.bind(this)),this.setSort()},onSort(){let[t,e]=this.sort.split(",").map(t=>t.trim());e=t?e||"desc":e,this.setSort(t,e)},setSort(t,e){t||(t=this.schema.sort,e=this.schema.desc?"desc":"asc",this.current.dir=t),this.current={sort:t,dir:e};const s="asc"===e?-1:1,i="desc"===e?-1:1;this.serversort||(this.items.sort((e,r)=>e[t]<r[t]?s:e[t]>r[t]?i:0),this.bodyHasRendered&&this.renderBody(this.items,this.columns)),this.headHasRendered&&this.displaySort()},onHeaderRender:function(){this.clickHandle&&this.clickHandle.remove(),this.clickHandle=this.on("header-click",this.onHeaderClick.bind(this)),this.displaySort()},displaySort(){this.currentSortField&&this.currentSortField.classList.remove(this.currentSortClass),this.current.dir&&(this.currentSortField=r.query(this.thead,`[data-field="${this.current.sort}"]`),this.currentSortClass="asc"===this.current.dir?"asc":"desc",this.currentSortField&&this.currentSortField.classList.add(this.currentSortClass));const t=this.current.sort?`${this.current.sort},${this.current.dir}`:null;this.serversort||this.fire("sort",{value:t})},onHeaderClick(t){let e,s=t.detail.field,i=t.detail.cell;!i||i.className.indexOf("no-sort")>-1?console.log("NOTARGET"):(e=s===this.current.sort?"asc"===this.current.dir?"desc":"asc":"desc",this.serversort?this.fire("sort",{field:s,dir:e}):this.setSort(s,e))}};t.exports=function(){this.hasSortable||(i.bindMethods(o,this),this.hasSortable=!0)}},function(t,e,s){const i=s(1),r=s(0),o=s(2),n={init(t){this.on("render",this.handleClicks.bind(this))},handleBodyClick(t){let e,s,i,o,n,l,a=t.target.closest("td");a&&(o=a.getAttribute("data-field")),n=t.target.closest("tr"),n&&(e=+n.getAttribute("data-index"),l=r.attr(n,"data-row-id"),l&&(s=this.getItemById(l),i={index:e,cell:a,row:n,item:s,field:o,value:s[o],target:t.target},this.fire("row-click",i)))},handleHeaderClick(t){let e=t.target.closest("th"),s={field:e&&e.getAttribute("data-field"),cell:e,target:t.target};e&&this.fire("header-click",s)},handleClicks(t){this.handle&&this.handle.remove(),this.handle=o.makeMultiHandle([this.on(t.detail.tbody,"keyup",t=>{"Enter"===t.key&&this.handleBodyClick(t)}),this.on(t.detail.tbody,"click",this.handleBodyClick.bind(this)),this.on(t.detail.thead,"click",this.handleHeaderClick.bind(this))])}};t.exports=function(){this.hasClickable||(i.bindMethods(n,this),this.hasClickable=!0)}},function(t,e,s){const i=s(0),r=s(1),o={init(){this.classList.add("selectable"),this.on("row-click",this.onRowClick.bind(this)),this.on("render-body",this.displaySelection.bind(this))},onSelected(t){t!==this.currentSelection&&this.selectRow(t)},onRowClick(t){this.selectRow(t.detail.item.id)},selectRow(t){let e;this.currentRow&&(this.currentRow.classList.remove("selected"),e=i.attr(this.currentRow,"data-row-id")),this.currentSelection=t===this.currentSelection?null:t;let s=this.getItemById(this.currentSelection);if("unselectable"===(s?s.class||s.className:null)&&(this.currentSelection=null,s=null,t=null),this.displaySelection(),this.currentSelection){const e={row:this.currentRow,item:s,value:t};this.emit("change",e)}else this.emit("change")},displaySelection(){if(this.currentSelection){const t=i.query(this,`[data-row-id="${this.currentSelection}"]`);t&&(t.classList.add("selected"),this.currentRow=t)}}};t.exports=function(){this.hasSelectable||(r.bindMethods(o,this),this.hasSelectable=!0)}},function(t,e,s){const i=s(0),r=s(1),o={init(){this.classList.add("scrollable"),this.on("render-body",this.onRender.bind(this)),this.on("resize",this.onRender.bind(this)),this.on("pre-render",this.onPreRender.bind(this))},renderTemplate(){this.tableHeadWrapper||(this.tableHeadWrapper=i("div",{className:"table-header-wrapper"},this),this.tableHeader=i("table",{className:"table-header",tabindex:"1"},this.tableHeadWrapper),this.thead=i("thead",{},this.tableHeader),this.tableBodyWrapper=i("div",{className:"table-body-wrapper",style:{"max-height":this["max-height"],position:this["max-height"]?"static":"absolute"}},this),this.tableBody=i("table",{className:"table-body",tabindex:"1"},this.tableBodyWrapper),this.tbody=i("tbody",{},this.tableBody))},onPreRender(){this.table&&(this.scrollPos=this.table.scrollLeft)},onRender(t){if(this.sizeColumns(),this.scrollPos){const t=this.scrollPos;window.requestAnimationFrame(()=>{this.scrollLeft=t}),this.scrollPos=0}},handleScroll(t){const e=this.tableHeadWrapper,s=this.tableBodyWrapper;let i;e.scrollLeft=s.scrollLeft,e.scrollLeft!==s.scrollLeft?(i=Math.ceil(e.scrollLeft-s.scrollLeft),e.style.left=i+1+"px",this.hasShift=!0):this.hasShift&&(e.style.left="",this.hasShift=!1)},connectScroll(t){window.requestAnimationFrame(function(){this.scrollHandle&&this.scrollHandle.remove(),this.scrollHandle=this.on(this.tableBodyWrapper,"scroll",this.handleScroll.bind(this))}.bind(this))},sizeColumns(){const t=this.thead.parentNode,e=this.tbody.parentNode,s=this.colSizes;let r,o,n,l,a,h=this,c=i("div",{style:{position:"absolute",width:"100px",height:"100px",zIndex:-1}},document.body),d=h.parentNode,u=t.querySelectorAll("th"),b=100/u.length+"%",m=e.querySelector("tr"),p=function(t){const e=t["stretch-column"],s=t.columns;if("all"===e)return"all";if("none"===e)return-1;if(!e||"last"===e)return s.length-1;return s.findIndex(t=>t.key===e)}(this);if(m){for(c.appendChild(h),a=m.querySelectorAll("td"),i.style(t,{position:"absolute",width:100}),i.style(e,{position:"absolute",width:100}),r=0;r<u.length;r++)i.style(u[r],{width:"",minWidth:""}),i.style(a[r],{width:"",minWidth:""});window.requestAnimationFrame(()=>{for(r=0;r<u.length;r++)n=i.box(u[r]).width,l=i.box(a[r]).width,s[r]?(i.style(u[r],{minWidth:s[r],maxWidth:s[r]}),i.style(a[r],{minWidth:s[r],maxWidth:s[r]})):/fixed\-width/.test(a[r].className)||(o=Math.max(n,l),i.style(u[r],{minWidth:o}),i.style(a[r],{minWidth:o})),"all"===p?(i.style(a[r],{width:b}),i.style(u[r],{width:b})):p===r&&(i.style(a[r],{width:"100%"}),i.style(u[r],{width:"100%"}));const m=i.box(this.tableHeader).height;h.tableBodyWrapper.style.top=m-1+"px",i.style(t,{position:"",width:""}),i.style(e,{position:"",width:""}),d.appendChild(h),i.destroy(c),this.connectScroll()})}}};t.exports=function(){this.hasScrollable||(r.bindMethods(o,this),this.hasScrollable=!0)}},function(t,e,s){s(11);const i=s(0),r=s(2);function o(t){const e=n(t.toString()),s=/\./.test(e)?function(t){let e=parseFloat(`0.${t}`);return e=Math.round(100*e),e>9?`${e}`:`0${e}`}(e.split(".")[1]):"00";return`$${function(t,e){const s=[];for(;t.length;)s.unshift(t.substring(t.length-e,t.length)),t=t.substring(0,t.length-e);return s}(e.split(".")[0],3).join(",")}.${s}`}function n(t){const e=t.toString().match(/\d|\./g);return e?e.join(""):""}function l(t,e){return t="&nbsp;"===t?"":t,e.fromHtml(t)}const a={currency:{fromHtml:t=>n(t),toHtml:t=>0===t?"$0.00":t?o(t):"&nbsp;"},percentage:{fromHtml:t=>n(t),toHtml:t=>0===t?"0%":t?n(t)+"%":"&nbsp;"},integer:{fromHtml:t=>t.toString().replace(/\D/g,""),toHtml:t=>t.toString().replace(/\D/g,"")},default:{fromHtml:t=>t,toHtml:t=>t}};t.exports=function(t,e){switch(t.component.type){case"link":return function(t,e){return i("a",{href:e[t.component.url],html:e[t.key]})}(t,e);case"ui-input":return function(t,e){const s=a[t.component.format]||a.default;function o(o){const n=o.parentNode;let a,h=!0;n.style.width||(h=!1,i.style(n,"width",i.box(n).w)),n.removeChild(o);const c=i("ui-input",{type:t.component.subtype||"text",value:l(o.textContent,s)},n);c.onDomReady(()=>{c.input.focus()});const d=()=>{n.appendChild(o),c.destroy(),h||i.style(n,"width","")};c.on("blur",()=>{d()}),c.on("keyup",t=>{a=setTimeout(()=>{"Enter"!==t.key&&"Escape"!==t.key||d()},1)}),c.on("change",i=>{i.stopPropagation(),o.innerHTML=function(t,e){return null==t||""===t?"&nbsp;":e.toHtml(t)}(i.value,s),d(),e[t.key]=s.fromHtml(i.value,s),r.emit(o,"change",{value:e}),clearTimeout(a)})}return i("div",{class:"td-editable",html:s.toHtml(e[t.key])||"&nbsp;",tabindex:"0",onClick(){o(this)},onKeyup(t){"Enter"===t.key&&o(this)}})}(t,e);case"ui-dropdown":return function(t,e){const s=i("ui-dropdown",{data:t.component.options,value:e[t.key]});return s.on("change",i=>{i.stopPropagation(),i&&null!=i.value&&(e[t.key]=i.value,r.emit(s.parentNode,"change",{value:e}))}),s}(t,e);case"ui-checkbox":return function(t,e){const s=i("ui-checkbox",{value:e[t.key]});return s.on("change",i=>{i.stopPropagation(),i&&null!=i.value&&(e[t.key]=i.value,r.emit(s.parentNode,"change",{value:e}))}),s}(t,e);default:return e[t.key]}}},function(t,e){t.exports=i},function(t,e,s){}])}));
//# sourceMappingURL=index.js.map